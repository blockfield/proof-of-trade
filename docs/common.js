"use strict";(self.webpackChunkproof_of_trade_client=self.webpackChunkproof_of_trade_client||[]).push([[592],{1642:(b,m,o)=>{o.d(m,{k:()=>h});var l=o(7716),u=o(9344);let h=(()=>{class v{constructor(s){this.toastr=s}success(s,f=null){this.toastr.clear(),this.toastr.success(s,f,{positionClass:"toast-bottom-right"})}error(s,f=null){this.toastr.clear(),this.toastr.error(s,f,{positionClass:"toast-bottom-right"})}}return v.\u0275fac=function(s){return new(s||v)(l.LFG(u._W))},v.\u0275prov=l.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},8031:(b,m,o)=>{o.d(m,{$:()=>D});var l=o(4762),u=o(9412),h=o(3384);class v{constructor(c,t,e,i,n,a,y){this.type=c,this.value=t,this.salt=e,this.previousBalance=i,this.previousBalanceHash=n,this.hash=a,this.price=y}}class S{constructor(c,t,e,i,n,a){this.balanceHash=c,this.balance=t,this.previousBalanceHash=e,this.hashes=i,this.prices=n,this.price_now=a}toArray(){let c=[this.balanceHash,this.balance,this.previousBalanceHash];return c.push(...this.hashes,...this.prices,this.price_now),c}}var s=o(7716),f=o(6044),P=o(9358);let B=(()=>{class r{constructor(){}prove(t){return(0,l.mG)(this,void 0,void 0,function*(){return window.witness(t)})}verify(t,e,i){return(0,l.mG)(this,void 0,void 0,function*(){return window.groth16Verify(t,e.toArray(),i)})}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=s.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var V=o(6215);let A=(()=>{class r{constructor(){this.verificationKey=new V.X(null),this.initAssets()}initAssets(){fetch("./assets/verification_key.json").then(t=>t.json()).then(t=>{this.verificationKey.next(t)})}getVerificationKey(){if(!this.verificationKey.getValue())throw new Error("Verfiication key not loaded yet");return this.verificationKey.getValue()}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=s.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),D=(()=>{class r{constructor(t,e,i,n,a){this.contract=t,this.priceService=e,this.walletService=i,this.witnessService=n,this.assetsService=a}prove(t){return(0,u.D)(this.internalProve(t))}internalProve(t){return(0,l.mG)(this,void 0,void 0,function*(){const e=this.walletService.getAddress(),i=yield this.contract.getTradeLen(),n=yield this.contract.getSignal(e,i-2),a=yield this.contract.getSignal(e,i-1),y=h.Z.floorNumber(t.proofs[0].price),w=h.Z.floorNumber(t.proofs[1].price),d=h.Z.removeDecimalDigitsNumber(this.priceService.getBtcPriceValue()),p=yield this.contract.getProofLen(e);let g="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==p&&(g=yield this.contract.getPrevBalanceHash(e,p-1));let F=new v([t.proofs[0].action,t.proofs[1].action],[t.proofs[0].amount,t.proofs[1].amount],[t.proofs[0].nonce,t.proofs[1].nonce],[t.usdBalance,t.btcBalance],g,[n.hash,a.hash],[h.Z.removeDecimalDigitsNumber(y),h.Z.removeDecimalDigitsNumber(w),d]);const Z=yield this.witnessService.prove(F);yield this.contract.addPeriodProof(Z,[h.Z.numberToBigInt(d)])})}verify(t,e){return(0,u.D)(this.internalVerify(t,e))}verifyAll(t,e){return(0,u.D)(this.internalVerifyAll(t,e))}internalVerifyAll(t,e){return(0,l.mG)(this,void 0,void 0,function*(){let i=!0;for(const n of e){let a=yield this.internalVerify(t,n);i=i&&a}return new Promise(n=>{n(i)})})}internalVerify(t,e){return(0,l.mG)(this,void 0,void 0,function*(){const i=yield this.contract.getPeriodProofs(t,e),n=yield this.contract.getSignal(t,2*e),a=yield this.contract.getSignal(t,2*e+1),y=h.Z.bigIntToFloorNumber(n.price),w=h.Z.bigIntToFloorNumber(a.price),d=h.Z.bigIntToFloorNumber(i.prices[0]);let p="639470893622803446635721399483204517617715645899470263648676575355455357367";0!==e&&(p=(yield this.contract.getPeriodProofs(t,e-1)).newBalanceHash);const g=new S(i.newBalanceHash,i.y,p,[n.hash,a.hash],[y,w],d);return this.witnessService.verify(this.assetsService.getVerificationKey(),g,i.proof)})}}return r.\u0275fac=function(t){return new(t||r)(s.LFG("SmartContractInterface"),s.LFG(f.N),s.LFG(P.X),s.LFG(B),s.LFG(A))},r.\u0275prov=s.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()}}]);